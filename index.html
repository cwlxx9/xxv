# ============================================================
# ‚öôÔ∏è PowerShell 5 Bootstrapper for Menu-NoGUI.ps1
# ============================================================

# ------------------------------------------------------------
# Step 1: Ensure Running as Administrator
# ------------------------------------------------------------
$IsAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")
if (-not $IsAdmin) {
    Write-Host "‚ö†Ô∏è  Not running as Administrator. Restarting as admin..."
    Start-Process powershell.exe "-ExecutionPolicy Bypass -File `"$PSCommandPath`"" -Verb RunAs
    exit
}

Write-Host "‚úÖ Running as Administrator"

# ------------------------------------------------------------
# Step 2: Check for PowerShell 7 (pwsh.exe)
# ------------------------------------------------------------
$pwshPath = (Get-Command pwsh.exe -ErrorAction SilentlyContinue).Source

if (-not $pwshPath) {
    Write-Host "‚öôÔ∏è PowerShell 7 not found. Installing via winget..."
    
    # Check if winget exists
    if (-not (Get-Command winget.exe -ErrorAction SilentlyContinue)) {
        Write-Host "‚ùå winget not found. Please install Windows Package Manager first."
        exit 1
    }

    # Install PowerShell 7
    Start-Process winget -ArgumentList 'install --id Microsoft.PowerShell --source winget --accept-source-agreements --accept-package-agreements' -Wait
    $pwshPath = (Get-Command pwsh.exe -ErrorAction SilentlyContinue).Source

    if (-not $pwshPath) {
        Write-Host "‚ùå PowerShell 7 installation failed. Exiting."
        exit 1
    }
}

Write-Host "‚úÖ PowerShell 7 found at: $pwshPath"

# ------------------------------------------------------------
# Step 3: Run Menu-NoGUI.ps1 from GitHub
# ------------------------------------------------------------
Write-Host "üöÄ Launching Menu-NoGUI.ps1 using PowerShell 7..."
Start-Process $pwshPath -ArgumentList "-NoProfile -ExecutionPolicy Bypass -Command `"irm https://raw.githubusercontent.com/cwlxxx/vault7/refs/heads/main/Menu-NoGUI.ps1 | iex`""

# Done
Write-Host "‚úÖ Script execution triggered in PowerShell 7."
