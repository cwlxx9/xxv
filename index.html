# ============================================================
# ‚öôÔ∏è PowerShell 5 ‚Üí PowerShell 7 Auto-Installer & Launcher
# ============================================================

# --- Step 1 : Check for PowerShell 7 ---
Write-Host "üîç Checking for PowerShell 7..."
$pwshPath = (Get-Command pwsh.exe -ErrorAction SilentlyContinue).Source

if (-not $pwshPath) {
    Write-Host "‚öôÔ∏è  PowerShell 7 not found. Installing silently via winget..."

    if (-not (Get-Command winget.exe -ErrorAction SilentlyContinue)) {
        Write-Host "‚ùå  Windows Package Manager (winget) not found. Please install it manually."
        exit 1
    }

    # Start installation (silent with progress)
    $progress = Start-Job {
        for ($i = 0; $i -le 100; $i += 5) {
            Write-Progress -Activity "Installing PowerShell 7..." -Status "$i% Complete" -PercentComplete $i
            Start-Sleep -Milliseconds 300
        }
    }

    Start-Process winget -ArgumentList 'install --id Microsoft.PowerShell --source winget --accept-package-agreements --accept-source-agreements --silent' -Wait

    Stop-Job $progress | Out-Null
    Remove-Job $progress | Out-Null

    $pwshPath = (Get-Command pwsh.exe -ErrorAction SilentlyContinue).Source
    if (-not $pwshPath) {
        Write-Host "‚ùå  PowerShell 7 installation failed."
        exit 1
    }
    Write-Host "‚úÖ PowerShell 7 installed successfully."
} else {
    Write-Host "‚úÖ PowerShell 7 already installed."
}

# --- Step 2 : Run Remote Script using PowerShell 7 (as Admin) ---
$RemoteScript = 'https://raw.githubusercontent.com/cwlxxx/vault7/refs/heads/main/Menu-NoGUI.ps1'

Write-Host "üöÄ Launching Menu-NoGUI.ps1 in PowerShell 7 (Admin mode)..."
Start-Process -FilePath $pwshPath `
    -ArgumentList "-NoProfile -ExecutionPolicy Bypass -Command `"irm $RemoteScript | iex`"" `
    -Verb RunAs

# --- Step 3 : Exit PowerShell 5 ---
Write-Host "‚úÖ Task complete. Closing PowerShell 5..."
Start-Sleep -Seconds 2
exit
