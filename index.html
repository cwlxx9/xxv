# ============================================================
# ‚öôÔ∏è PowerShell 5 ‚Üí PowerShell 7 Installer & Remote Script Launcher
# ============================================================

# --- Step 1 : Check for PowerShell 7 ---
Write-Host "üîç Checking for PowerShell 7..."
$pwshPath = (Get-Command pwsh.exe -ErrorAction SilentlyContinue).Source

if (-not $pwshPath) {
    Write-Host "‚öôÔ∏è  PowerShell 7 not found. Installing (visible, non-interactive)..."

    if (-not (Get-Command winget.exe -ErrorAction SilentlyContinue)) {
        Write-Host "‚ùå  Windows Package Manager (winget) not found. Please install it manually."
        exit 1
    }

    # Install PowerShell 7 visibly, no user prompts
    winget install --id Microsoft.PowerShell --source winget --accept-package-agreements --accept-source-agreements

    # Try locating the new PowerShell 7 path manually
    Write-Host "üîÅ Checking installation path..."
    $possiblePaths = @(
        "$env:ProgramFiles\PowerShell\7\pwsh.exe",
        "$env:ProgramFiles\PowerShell\7-preview\pwsh.exe",
        "$env:LocalAppData\Microsoft\WindowsApps\pwsh.exe"
    )
    foreach ($path in $possiblePaths) {
        if (Test-Path $path) {
            $pwshPath = $path
            break
        }
    }

    if (-not $pwshPath) {
        Write-Host "‚ùå  Could not find pwsh.exe even after installation."
        Write-Host "‚û°Ô∏è  Please restart PowerShell, then run this script again."
        exit 1
    }

    Write-Host "‚úÖ PowerShell 7 installed and found at: $pwshPath"
} else {
    Write-Host "‚úÖ PowerShell 7 already installed at: $pwshPath"
}

# --- Step 2 : Launch Remote Script using PowerShell 7 (Admin mode) ---
$RemoteScript = 'https://raw.githubusercontent.com/cwlxxx/vault7/refs/heads/main/Menu-NoGUI.ps1'
Write-Host "üöÄ Launching remote script in PowerShell 7 (Admin mode)..."

Start-Process -FilePath $pwshPath `
    -ArgumentList "-NoProfile -ExecutionPolicy Bypass -Command `"irm $RemoteScript | iex`"" `
    -Verb RunAs

# --- Step 3 : Exit PowerShell 5 ---
Write-Host "‚úÖ Task complete. Closing PowerShell 5..."
Start-Sleep -Seconds 2
exit
